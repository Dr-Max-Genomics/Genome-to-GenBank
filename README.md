# End-to-End Workflow: From Genome FASTA + GFF to NCBI-Ready .sqn Files
## A practical, reproducible guide for fungal genome annotation submissions

This repository documents a complete workflow for converting a genome FASTA file and a GFF3 annotation file into a validated .sqn file suitable for NCBI submission as an annotation-only update. The goal is to provide a clear, reproducible reference for preparing WGS-based fungal genome annotations for GenBank.

This guide reflects lessons learned during the annotation and submission of Fusarium cerealis strain F-23-4.4, including common pitfalls, NCBI requirements, and practical fixes.

## Overview

NCBI accepts genome annotation updates in the form of .sqn files generated by table2asn. To produce a valid .sqn, you must supply:

- A genome FASTA file containing all contigs in the WGS project
- A GFF3 annotation file containing features for contigs that have annotation
- A submission template (.sbt)
- A registered locus_tag prefix
- Correct WGS FASTA headers
- A consistent mapping between FASTA and GFF seqids

This workflow describes how to prepare these inputs, validate them, and generate a submission-ready .sqn.

## Requirements
```bash
- Linux or macOS environment
- bioawk
- table2asn (current NCBI version)
- GFF3 annotation file
- Genome FASTA file
- Registered locus_tag prefix
- Submission template (.sbt)
```
## 1. Prepare the Genome FASTA

NCBI requires WGS FASTA headers in the following format:
```bash
>gnl|WGS:<WGS_PREFIX>|SeqID|gb|<ACCESSION>

#Example:

>gnl|WGS:JBQWEA|SeqID|gb|JBQWEA010000001.1
```
Do not shorten or modify this header format.

### Verify contig lengths

'''bash
bioawk -c fastx '{ print $name, length($seq) }' genome.fsa
```

Confirm that all contigs expected in the WGS project are present.

## 2. Ensure All WGS Contigs Are Included

For annotation-only updates, NCBI requires that every contig in the WGS accession be included in the FASTA, even if unannotated.

If contigs are missing, extract and append them:

```bash
bioawk -c fastx '($name=="JBQWEA010000002.1"  $name=="JBQWEA010000003.1"){print ">"$name"\n"$seq}' all_contigs.fsa > extra_contigs.fsa
cat extra_contigs.fsa >> genome_fixed.fsa
```

Do not add "fake" features to the GFF. Unannotated contigs should remain absent from the GFF.

## 3. Prepare the GFF3 Annotation File

Requirements:

- Must use the same contig accessions as the FASTA
- Must be sorted by contig and coordinate
- Must not contain annotation for contigs that have none
- Must follow standard GFF3 formatting

Check contig IDs:

```bash
cut -f1 genome_clean.gff  grep -v "^#"  sort -u
```


These must match the FASTA accessions exactly.

## 4. Run table2asn

Example command:

```bash
table2asn 
-t template.sbt 
-i genome_fixed.fsa 
-f genome_clean.gff 
-o genome.sqn 
-l ACT9NY 
-V vbr 
-Z discrep_report.txt 
-a s 
-j "[organism=Fusarium cerealis] [strain=F-23-4.4]"
```

Key notes:

- -l sets the locus_tag prefix
- -V vbr enables validation
- -Z writes a discrepancy report
- -a s indicates a set of sequences
- -j adds source qualifiers

## 5. Validate the Output

table2asn produces:
```bash
- .sqn (submission file)
- .val (validation report)
- .dr (discrepancy report)
- .stats (summary)
```
Check for:

- Missing product names
- CDS without parent mRNA
- SeqID mismatches
- Missing contigs
- Incorrect locus_tag usage

If the .sqn passes validation with no critical errors, it is ready for submission.

## 6. Submit to NCBI

For annotation-only updates:

- Upload only the .sqn file (zipped is recommended)
- Do not upload FASTA or GFF
- Specify the BioProject, BioSample, and WGS master accession
- Indicate that this is an annotation-only update
- Confirm that all contigs are included

Example private comment to NCBI staff:
`This submission is an annotation-only update for the current version of the genome. All contigs are included. The annotation was generated in GFF3 format and converted to ASN.1 using table2asn with the registered locus_tag prefix ACT9NY. No changes were made to the underlying genome assembly. Please process this as an annotation-only update to the existing WGS record.`


## 7. Troubleshooting

### NCBI rejects the submission because contigs are missing
Append missing contigs to the FASTA and rerun table2asn.

### table2asn reports SeqID mismatches
Ensure FASTA and GFF use identical contig accessions.

### Missing product qualifiers
Ensure CDS features have product names. table2asn will propagate product names from mRNA to CDS if needed.

### Mitochondrial contig identification
Use BLAST against a reference mitochondrial genome.

Example:
`blastn -query genome_fixed.fsa -subject mito_ref.fa -outfmt 6`

## 8. Reproducibility and Version Tracking

This workflow encourages:

- Explicit versioning of FASTA, GFF, and table2asn
- Documentation of all commands used
- Storage of validation reports
- Clear mapping between contigs and chromosomes

This ensures that future users can reproduce the submission exactly.

## Citation

If you use this workflow, please cite the tools and databases used (NCBI, table2asn, bioawk, etc.). This repository is intended as a practical guide for fungal genome annotation and submission workflows.
